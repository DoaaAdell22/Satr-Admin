import{r as l,t as D,C as L,o as B,q as $,s as T,v as z,a as P,f as k,U as S,j as e,F as s,B as I,i as v,n as U,p as G}from"./index-CbNkVbyA.js";import{u as M}from"./useMutation-DwAQVmwo.js";import{u as W,F as n}from"./index-nfIlcgR5.js";import{D as X,G as K}from"./index-hCKGgHjB.js";import{l as Y}from"./libphonenumber-CMUTMTJY.js";import{C as O}from"./index-w51GdvMh.js";import{U as _,a as F}from"./UploadOutlined-BProoqtw.js";import{I as c}from"./index-VC5Afaew.js";import{S as w}from"./index-Bs3OOa-i.js";import"./utils-km2FGkQ4.js";import"./row-CIqPCr0D.js";import"./QuestionCircleOutlined-CFn8tONO.js";import"./DeleteOutlined-BtHf3aBj.js";import"./index-CbNQXSC4.js";const{Option:E}=w;function V(o){return o&&o.type&&(o.type.isSelectOption||o.type.isSelectOptGroup)}const Z=(o,f)=>{var p;const{prefixCls:h,className:j,popupClassName:d,dropdownClassName:b,children:g,dataSource:N}=o,m=D(g);let t;m.length===1&&l.isValidElement(m[0])&&!V(m[0])&&([t]=m);const r=t?()=>t:void 0;let i;m.length&&V(m[0])?i=g:i=N?N.map(u=>{if(l.isValidElement(u))return u;switch(typeof u){case"string":return l.createElement(E,{key:u,value:u},u);case"object":{const{value:A}=u;return l.createElement(E,{key:A,value:A},u.text)}default:return}}):[];const{getPrefixCls:a}=l.useContext(L),x=a("select",h),[y]=B("SelectLike",(p=o.dropdownStyle)===null||p===void 0?void 0:p.zIndex);return l.createElement(w,Object.assign({ref:f,suffixIcon:null},$(o,["dataSource","dropdownClassName"]),{prefixCls:x,popupClassName:d||b,dropdownStyle:Object.assign(Object.assign({},o.dropdownStyle),{zIndex:y}),className:T(`${x}-auto-complete`,j),mode:w.SECRET_COMBOBOX_MODE_DO_NOT_USE,getInputElement:r}),i)},C=l.forwardRef(Z),H=z(C);C.Option=E;C._InternalPanelDoNotUseOrYouWillBeFired=H;const J=C,R=Y.PhoneNumberUtil.getInstance(),{fetchProfileDataSuccess:Q}=G,ee=o=>{try{return R.isValidNumber(R.parseAndKeepRawInput(o))}catch{return!1}},q=async o=>{const p=await(await fetch(o,{cache:"no-cache"})).blob();return new Promise((h,j)=>{const d=new FileReader;d.readAsDataURL(p),d.onloadend=()=>{const b=d.result;h(b)},d.onerror=j})};function fe(){const o=P(({profile:t})=>t.data),f=P(({Auth:t})=>t.idToken),p=k();l.useEffect(()=>{const t={...o};t.mobileNumber=t.countryCode+"_"+t.mobileNumber,q(S+"/"+t.photoUrl).then(r=>{t.photo64=r;const i=t.offersImagesURLs.map(a=>`${S}/${a}`);Promise.all(i.map(q)).then(a=>a.map(x=>({uid:"-1",name:"icon64",status:"done",url:x}))).then(a=>{t.base64OffersImages=a,h.setFieldsValue(t)})})},[]);const[h]=W(),j=M({mutationFn:t=>v.put("Operations",t,{headers:{Authorization:`Bearer ${f}`}}),onSuccess:t=>{const{message:r}=t.data;v.get("Operations/info",{headers:{"X-Portal":"dashboard",Authorization:`Bearer ${f}`}}).then(i=>{const{data:a}=i.data;a.isVerified=!0,a.approvalStatus==="Approved"&&(a.isApproved=!0),a.userActivated&&(a.isActivated=!0),p(Q(a))}).catch(i=>{}),U.success(r,{position:"top-center",duration:5e3})},onError:t=>{const{data:{message:r}}=t.response;U.error(r,{position:"top-center",duration:5e3})}}),d=t=>{var i,a,x;const r=t.mobileNumber;t.mobileNumber=r.split("_")[1],t.countryCode=r.split("_")[0],typeof t.photo64!="string"?t.photo64=(a=(i=t.photo64)==null?void 0:i[0])==null?void 0:a.thumbUrl.split(",")[1]:t.photo64=(x=t.photo64)==null?void 0:x.split(",")[1],Array.isArray(t.base64OffersImages)&&(t.base64OffersImages=t.base64OffersImages.map(y=>y.url?y.url.split(",")[1]:y.thumbUrl.split(",")[1])),j.mutate(t)},[b,g]=l.useState([]),N=t=>{g(t?[".com",".org",".net"].map(r=>`${t}${r}`):[])},m=b.map(t=>({label:t,value:t}));return e.jsxs(n,{form:h,onFinish:d,layout:"vertical",children:[e.jsx(X,{orientation:"left",children:e.jsx(s,{id:"edit-profile"})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[e.jsx("div",{className:"w-full",children:e.jsx(O,{children:e.jsx(n.Item,{label:e.jsx(s,{id:"photo"}),name:"photo64",valuePropName:"fileList",getValueProps:function(t){return{fileList:typeof t=="string"?t?[{uid:"-1",name:"photoUrl",status:"done",url:t}]:[]:t}},getValueFromEvent:t=>Array.isArray(t)?t:t&&t.fileList,children:e.jsx(_.Dragger,{maxCount:1,name:"photoUrl",beforeUpload:t=>!1,listType:"picture-card",children:e.jsx(I,{type:"text",icon:e.jsx(F,{}),children:e.jsx(s,{id:"upload"})})})})})}),e.jsxs("div",{className:"w-full",children:[" ",e.jsxs(O,{children:[e.jsx(n.Item,{getValueFromEvent:(t,{country:{dialCode:r}})=>""+r+"_"+t.slice(r.length+1),label:e.jsx(s,{id:"mobileNumber"}),name:"mobileNumber",rules:[{required:!0,message:e.jsx(s,{id:"mobileNumber"})},{validator:async(t,r)=>{const i=r.split("_")[1],a="+"+r.split("_").join("");if(i&&(!r||!ee(a)))return Promise.reject(new Error("wrong number"))}}],children:e.jsx(K,{defaultCountry:"sa",inputStyle:{width:"100%"},charAfterDialCode:""})}),e.jsx(n.Item,{label:e.jsx(s,{id:"phoneNumber"}),name:"phoneNumber",rules:[{required:!0,message:e.jsx(s,{id:"phoneNumber"})}],children:e.jsx(c,{type:"text"})}),e.jsx(n.Item,{label:e.jsx(s,{id:"website"}),name:"website",rules:[{required:!0,message:e.jsx(s,{id:"website"})}],children:e.jsx(J,{options:m,onChange:N,children:e.jsx(c,{})})}),e.jsx(n.Item,{label:e.jsx(s,{id:"contactEmail"}),name:"contactEmail",rules:[{required:!0,message:e.jsx(s,{id:"contactEmail"})},{type:"email",message:e.jsx(s,{id:"contactEmail"})}],children:e.jsx(c,{type:"text"})})]})]})]}),e.jsxs("div",{className:"w-full h-[initial]",children:[" ",e.jsxs(O,{className:"!pt-4 h-full",children:[e.jsx(n.Item,{label:e.jsx(s,{id:"name"}),name:"name",rules:[{required:!0,message:e.jsx(s,{id:"name"})}],children:e.jsx(c,{})}),e.jsx(n.Item,{label:e.jsx(s,{id:"email"}),name:"email",rules:[{type:"email",message:e.jsx(s,{id:"email"})}],children:e.jsx(c,{})}),e.jsx(n.Item,{label:e.jsx(s,{id:"address"}),name:"address",rules:[{required:!0,message:e.jsx(s,{id:"address"})}],children:e.jsx(c,{type:"text"})}),e.jsx(n.Item,{label:e.jsx(s,{id:"latitude"}),name:"latitude",rules:[{required:!0,message:e.jsx(s,{id:"latitude"})}],children:e.jsx(c,{type:"text"})}),e.jsx(n.Item,{label:e.jsx(s,{id:"longitude"}),name:"longitude",rules:[{required:!0,message:e.jsx(s,{id:"longitude"})}],children:e.jsx(c,{type:"text"})}),e.jsx(n.Item,{label:e.jsx(s,{id:"base64offersimages"}),name:"base64OffersImages",valuePropName:"fileList",rules:[{required:!0,message:e.jsx(s,{id:"base64offersimages"})}],getValueProps:function(t){return{fileList:t}},getValueFromEvent:t=>Array.isArray(t)?t:t&&t.fileList,children:e.jsx(_,{maxCount:6,name:"image",beforeUpload:t=>!1,listType:"picture-card",children:e.jsx(I,{type:"text",icon:e.jsx(F,{}),children:e.jsx(s,{id:"upload"})})})})]})]})]}),e.jsx("div",{className:"text-end",children:e.jsx(n.Item,{children:e.jsx(I,{type:"primary",className:"mt-4",htmlType:"submit",loading:j.isPending,children:e.jsx(s,{id:"global.save"})})})})]})}export{fe as default};
